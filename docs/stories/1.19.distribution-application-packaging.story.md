# Story 1.19: Distribution: Implement Application Packaging

## Status: Draft

## Story

As a user on Windows, macOS, or Linux,
I want downloadable installers for the desktop app,
so that I can easily install and update the application without a development environment.

## Acceptance Criteria

1. Electron packaging is implemented using `electron-builder` with icons from `build/icons/` and the existing `build` block in `package.json`.
2. Cross‑platform artifacts are produced locally via a single command after a production build:
   - Windows: NSIS installer (`.exe`) and optional portable build.
   - macOS: DMG and ZIP.
   - Linux: AppImage and DEB (Ubuntu/Debian).
3. Initial distribution is manual and unsigned via GitHub Releases; no auto‑update enabled.
4. Release process documentation exists with clear rollback steps and platform‑specific installation notes.
5. Vite build is optimized for production (minification, sourcemap policy, chunking where helpful) without breaking the Electron runtime.
6. A basic E2E smoke test validates that a packaged artifact launches the app to the dashboard on the target OS.

## Scope

- In scope
  - Add `electron-builder` as a devDependency and wire packaging scripts.
  - Produce Windows/macOS/Linux artifacts locally.
  - Prepare manual GitHub Releases workflow and documentation for unsigned artifacts and rollback.
  - Optimize Vite production build configuration where safe.
  - Optional matrix in CI for building artifacts (publish disabled).

- Out of scope (future stories)
  - Code signing (Apple Developer ID, Windows code sign) and notarization.
  - Auto‑update via `electron-updater`.
  - Store distributions (Mac App Store/Microsoft Store).

## Tasks / Subtasks

- Packaging enablement
  - [ ] Add `electron-builder` to devDependencies and verify local install.
  - [ ] Confirm existing `package.json#build` block is respected by `electron-builder`.
  - [ ] Add scripts:
    - `dist`: `npm run build && electron-builder`
    - `dist:dir`: `npm run build && electron-builder --dir` (debug inspection)
    - `dist:win`, `dist:mac`, `dist:linux` (platform‑specific convenience)

- Artifact configuration
  - [ ] Ensure icons and product metadata match branding in `package.json#build`.
  - [ ] Windows: NSIS target; enable per‑user install by default; portable optional.
  - [ ] macOS: DMG + ZIP; disable hardened runtime/signing for initial unsigned builds.
  - [ ] Linux: AppImage + DEB; ensure desktop entry and categories.

- Vite production optimization
  - [ ] Confirm minification, module preloading, and chunking settings do not break preload/IPC.
  - [ ] Disable or scope sourcemaps for production artifacts; keep separate debug builds if needed.
  - [ ] Validate asset handling (images/fonts/css) for Electron environment.

- Release documentation
  - [ ] Create deployment guide in `docs/` covering:
    - Manual GitHub Release flow (draft → upload artifacts → publish/pre‑release).
    - Rollback by downloading and reinstalling previous artifacts.
    - OS‑specific unsigned install prompts and expectations.
  - [ ] Add README section linking to Releases and artifact types.

- Optional CI scaffolding (no publishing)
  - [ ] Add GitHub Actions workflow to build artifacts on tag with `--publish never` and attach to the draft release.
  - [ ] Gate with existing tests (unit/integration/E2E) before building artifacts.

- Smoke validation
  - [ ] Document manual smoke steps per OS (launch → dashboard visible → quit).
  - [ ] Add minimal Playwright/E2E note for packaged launches where feasible, or mark as manual validation for this story.

## Developer Notes

- Reference: `docs/architecture/infrastructure-and-deployment-integration.md`
  - `electron-builder` for packaging; unsigned manual releases via GitHub Releases.
  - Future: `electron-updater` after signing/notarization.
  - Current repo state: `package.json` already contains a `build` block; dependency and scripts are missing.

- Repository configuration
  - `package.json#build` already defines `appId`, `productName`, and icons for mac/win/linux.
  - Ensure `electron/main.js` and `preload.js` are compatible with production pack (no dev‑only paths).

- Vite/Electron alignment
  - Keep preload separate and ensure no treeshaking removes required IPC bridges.
  - Validate `vite.config.ts` build options for Electron target.

## Testing Plan

- Local commands
  - `npm run dist` → produces platform artifacts on the developer host OS.
  - Optional: platform‑specific `dist:win`/`dist:mac`/`dist:linux` scripts.

- Passing criteria
  - Artifacts generated successfully with expected names and sizes.
  - Installed app launches to the dashboard without dev server.
  - Basic navigation works; no console errors in production.

- E2E/Manual
  - Document per‑OS smoke checklist; run at least on primary dev OS for this story.
  - Follow‑up stories can extend automated packaged‑app E2E coverage.

## Risks

- Unsigned builds trigger OS prompts; users must accept unknown publisher warnings.
- Vite optimizations may break preload/IPC if misconfigured.
- Cross‑platform build limitations on non‑matching hosts (e.g., building macOS artifacts on Windows) without CI runners.

## Change Log

| Date       | Version | Description                                | Author |
|------------|---------|--------------------------------------------|--------|
| 2025-11-02 | 1.0     | Initial story draft (packaging & release)  | SM     |

## QA Results

To be completed by QA upon completion.



