# Story 1.10: UI Visual Cleanup & Consistency

## Status: In Progress

## Story

As a user and developer,
I want a visually consistent and responsive UI across Dashboard, Job Management, Single Job View, Failed Images Review, and Settings,
so that the application is easier to use, looks professional, and avoids layout glitches across screen sizes.

## Acceptance Criteria

1. Status badges are visually consistent across all relevant views.
   - Colors, shapes, and labels align with the design system.
   - No visual shifts between screens.
2. Dashboard header is responsive without overflow.
   - Actions wrap into a second row under a defined width threshold.
   - Header height accommodates wrapped controls.
3. Job Management search/filter header does not overflow on narrow widths.
4. Single Job View file paths are read-only and re-read at run/rerun. Paths are editable only in Settings. (No FileSelector in Single Job View.)
5. Input behavior is stable.
   - Numeric inputs do not change on scroll unintentionally.
   - Text input focus remains stable across tabs and modals.
6. Settings Panel fields have uniform widths and consistent helper/error text styling.
   - 'You have unsaved changes' message does not shift primary action buttons.
   - Message is displayed in a fixed-position area or modal that does not affect button layout.
7. Gallery search has improved hinting and empty-state messaging.
8. Single Job View stats show proper spacing/typography and Approved vs QC Failed breakdown.
9. Provide direct navigation from Settings panel to main Dashboard (not only via start page).
10. Replace checkboxes in Single Job View Edit and Failed Images Review Retry with toggels which are same stayle as in Settings pannel
11. Job managment pannel shold show the count of jobs with 'In progress' and 'Pending' stataus
12. Main dashboard shold show Success Rate, Images Generated, Avg Duration metriks too in the header not just Total Jobs statistics
13. In Single Job View 'Failed' (Generation failed) count statistics should be updated and shown
14. On Main Dasboard in Job progres panell Overall Progress (n generations) does not show the right persentage per generation and progress bar is not gettting visually filled correctly
15. On Main Dasboard in Job progres panell Current Generation Progress only getting filled to 20% (Initialization step) and not filling remaining 80% till 100% when Image Generation step is finished
16. On Main Dasboard in Job progres panell in progress steps progress stays only on first 'Initialization' - Image Generation step not getting highligted when in progress. Initialization icon highlight shold switch to 'Image Generation' step icon highlight when job moves to 'Image Generation' step

UPDATED BEHAVIOR — September 2025
- Unified single bar: Generation Progress (N generations)
  - Single generation (N=1): shows 0 while running; 100 on completion. Steps: Initialization turns active→completed, Image Generation turns active during run → completed on finish.
  - Multiple generations (N>1): percent = gensDone / totalGenerations × 100, updates per completed generation. With QC enabled, caps at 95% until QC completes, then 100%.
  - Reruns and modified-config reruns: UI uses live counts from status (executionId, gensDone, totalGenerations) to avoid stale values.

17. Main Dashboard Job History pannel filters are not working
18. In job items that shown on Main Dashboard in Job History 'success' images count not shown in parenhesis only 'total images' and 'failed' images are shown
19. Failed Images Review interfase is improved and hav more consistent view with overall interface, all controls work properly


## Tasks / Subtasks

- Status badges
  - [ ] Standardize colors, shapes, and labels across Dashboard, Job Management, Single Job View, Failed Images Review.

- Dashboard header responsiveness
  - [x] Increase header height and allow wrapping of actions to a second row under threshold.

- Job Management header layout
  - [x] Fix search + filters layout so it does not overflow on narrow widths.
  - [x] Normalize control heights; prevent Status/Date overlap; add controlled search spacing
  - [x] Implement explicit dateFrom/dateTo filtering (inclusive, timezone-safe)

- Single Job View edit parity
  - [x] Make file and directory fields read-only; show hint that files are re-read at run/rerun and paths are edited in Settings.

- Inputs behavior
  - [x] Prevent numeric field scroll jumps; ensure stable text input focus across tabs/modals.
  - [x] Increase generations cap to 2500 in Settings and Single Job View
  - [x] Single Job View: show Polling Timeout/Interval only when "Enable Polling Timeout" is ON (parity with Settings)
  

- Settings panel uniformity
  - [ ] Align field widths; unify helper/error styles.
  - [ ] Ensure 'You have unsaved changes' message does not shift 'Save Settings' and 'Reset to Defaults' buttons (use modal or fixed position area).

- Gallery UX
  - [x] Improve search hint and empty-state message.
  - [x] Add date range filter (Today/Week/Month + pickers) in Main Dashboard Image Gallery
  - [x] Make date filter comparison timezone-safe (YYYY-MM-DD)
  - [x] Implement Select All tied to current filtered set (Grid/List parity)
  - [x] Add Delete Selected bulk action (visible when any selected)
  - [x] Add Clear button to reset Job, Search, Sort, Date, and selection
  - [x] Search matches Generation Prompt, Metadata Title, Description, Tags, and metadata.prompt

- Single Job View stats layout
  - [x] Adjust spacing/typography; show Approved vs QC Failed breakdown.

- Navigation improvement
  - [ ] Add direct navigation control to main Dashboard from Settings panel.

- Controls consistency
  - [x] Replace checkboxes in Single Job View Edit and Failed Images Review Retry with toggels which are same stayle as in Settings pannel

- Main dasboard statistics, progress bars, indicators, filters improvements, control improvements
  - [x] Generation Progress (unified bar): single-gen 0→100; multi-gen 1/N updates; QC cap at 95% until completion
  - [x] Progress steps reflect current step: Initialization active→completed; Image Generation active during run → completed on finish; failure shows red
  - [x] Main dashboard shold show Success Rate, Images Generated, Avg Duration metriks too in the header not just Total Jobs statistics
  - [x] Reconciled: Dashboard uses unified Generation Progress bar (N-aware 1/N and QC cap); visually fills correctly per updated behavior
  - [x] Reconciled: Single-gen shows 0→100 (no 20/80); multi-gen handled by unified bar
  - [x] Steps reflect backend currentStep: Initialization active→completed; Image Generation active during run → completed on finish; failure shows red
  - [x] Fix Main Dashboard Job History pannel filters not working
  - [ ] Fix job items that shown on Main Dashboard in Job History 'success' images count not shown in parenhesis only 'total images' and 'failed' images are shown
  - [x] Make 'Delete Selected' button in the header of Imagge Gallery tab of Main Dashboard which shold apper when several images are selected or select all checkbox is ticked in


- Job managment pannel statistics, progress bars, indicators, filters improvements
  - [x] Job managment pannel shold show the count of jobs with 'In progress' and 'Pending' stataus


- Single Job View statistics, progress bars, indicators, filters improvements
   - [x] In Single Job View 'Failed' (Generation failed) count statistics should be updated and shown
   - [x] Fix Single Job View filters to show Completed (approved), Failed, and Pending; add Pending to filter dropdown
   - [ ] The logs in Logs tab of  Single Job View shold be shown in same format as they shown in 'Logs' panel Main Dashborard
   - [ ] Add vertical scroll bar for the image area in Single Job View 'Images' Tab in Grid Na List view
   - [ ] Make image thubnails in List view in of Single Job View 'Images' Tab look same as in Main Dasboard 'Image Gallery' tab
   - [ ] Prevent status badges from splitting to the several rows in List view of Single Job View 'Images' Tab
   - [ ] Make color of the badges in Single Job View adhere to the same status colour codes as the are in other panels and pages 


- Failed images review UI (finalized)
  -  [x] Fix filters and search (robust, combined ribbon with bulk actions)
  -  [x] Grid/List view toggle identical to Image Gallery (same SVGs/styles)
  -  [x] Grid overlay actions left‑aligned; list view Actions column with icons
  -  [x] Single image modal: fixed height (no resize), centered image, pan/zoom toolbar, tabs (Details/AI Metadata/Processing) aligned with Image Gallery, with < > navigation
  -  [x] Unified badges/icons/labels; “QC Failed” badge in header; Approve/Retry/Delete in header
  -  [x] Approve & Retry original/custom verified end‑to‑end; renderer refreshes protocol roots with destination directory so thumbnails render immediately; file paths visible in Gallery

- Overal status badges badges consistensy across all interfases
  - [ ] Make shore badges shold be same form, same colour, and having same style .svg icons in them accross all interfaces. The status text shold be eather lowercase or Capitalized
  - [x] Add unified 'Approved' badge with check SVG on Image Gallery grid cards
  - [x] Move Image Gallery grid selection checkbox to top-right for consistency
  - [x] Add unified 'Approved' badge (with check SVG) to Image Gallery grid cards on Main Dashboard
  - [x] Move Image Gallery grid selection checkbox from top-left to top-right for consistency

## Dev Notes

- Coordinate with the design tokens used across components to keep badges and toggles consistent.
- Reuse existing `FileSelector` component for file inputs to avoid duplication.
- Consider adding small layout utilities in CSS/Tailwind for common headers.

## Testing Plan

- Visual review across three widths (≥1280px, ~1024px, ~800px).
- Snapshot tests for key components if feasible without brittleness.
- Manual UX checks for inputs: scroll on numeric, focus retention on text fields, and layout stability when unsaved changes appear.

## Risks

- CSS changes may affect unrelated components; mitigate with targeted selectors and component-scoped styles.
- Overuse of snapshot tests can be brittle; prefer functional assertions.

## Dev Agent Record

### Agent Model Used
- dev (James)

### Debug Log References
- 2025-09-20: Repository history scrubbed to remove sensitive logs; push protection satisfied. Ready to proceed with Story 1.10 implementation.

### Completion Notes
- Failed Images Review brought to parity with Image Gallery and validated: Approve, Retry (original/custom), thumbnails render post‑move, paths universal via original JobConfiguration with cross‑platform defaults.

### File List
- src/renderer/components/common/StatusBadge.tsx (added)
- src/renderer/components/Jobs/JobManagementPanel.tsx (edited)
- src/renderer/components/Jobs/SingleJobView.tsx (edited)
- src/renderer/components/Dashboard/JobHistory.tsx (edited)
- src/renderer/components/Dashboard/FailedImageCard.tsx (edited)
- src/renderer/components/Dashboard/FailedImagesReviewPanel.tsx (edited)

## Change Log

| Date       | Version | Description                                | Author |
|------------|---------|--------------------------------------------|--------|
| 2025-09-18 | 1.0     | Align story to b-mad template; refine ACs | PO     |
| 2025-09-20 | 1.1     | Set In Progress; init Dev Agent Record     | Dev    |
| 2025-09-20 | 1.2     | Unify badges (initial), replace emojis with SVGs     | Dev    |
| 2025-09-21 | 1.3     | Image Gallery: added bulk Delete Selected; fixed selection reset after deletion | Dev    |
| 2025-09-21 | 1.4     | Dashboard: step color logic aligned (active-only highlight, no checkmarks); on failure, Job History refreshes immediately and logs remain briefly visible | Dev    |
| 2025-10-04 | 1.5     | Failed Images Review finalized: UI parity with Gallery; actions in header; pan/zoom; tabs; protocol roots refresh after approve/retry; docs synced | Dev |

## QA Results

To be completed by QA upon completion.