#!/bin/sh

# Husky pre-commit hook: critical regression tests including retry functionality

echo "ğŸ§ª Running critical regression tests..."

# Test retry functionality (most critical)
echo "ğŸ”„ Testing Retry Functionality..."
npm run test:retry || exit 1

# Test job management (existing critical tests)
echo "ğŸ“‹ Testing Job Management..."
npm run test:job-management || exit 1

# Test cross-platform path handling (critical for preventing hardcoded paths)
echo "ğŸ›£ï¸ Testing Cross-Platform Path Handling..."
npm test -- tests/unit/backend/pathResolution.test.js --run || exit 1

# Test import regression (prevents constructor errors)
echo "ğŸ“¦ Testing Import Regression..."
npm test -- tests/unit/backend/importRegression.test.js --run || exit 1

# Test retry executor functionality (prevents retry_pending lock)
echo "ğŸ”„ Testing Retry Executor Functionality..."
npm test -- tests/unit/services/RetryExecutor.test.ts --run || exit 1

echo "âœ… All critical tests passed!"
